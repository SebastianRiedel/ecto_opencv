

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>writing opencv cells &mdash; ecto_opencv</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ecto_opencv" href="index.html" />
    <link rel="prev" title="ecto_opencv conventions" href="conventions.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25265185-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="conventions.html" title="ecto_opencv conventions"
             accesskey="P">previous</a> |</li>
    <li><a href="http://ecto.willowgarage.com/">ecto.willowgarage.com</a> &raquo;</li>
    
        <li><a href="index.html">ecto_opencv</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="conventions.html"
                        title="previous chapter">ecto_opencv conventions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/writing_opencv_cells.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writing-opencv-cells">
<h1>writing opencv cells<a class="headerlink" href="#writing-opencv-cells" title="Permalink to this headline">Â¶</a></h1>
<p>Since opencv uses <tt class="docutils literal"><span class="pre">cv::Mat</span></tt> which behaves like a smart pointer, it is
important that cells not munge the output data by working in place.</p>
<p>One solution to this issue, so that cells may play nicely in multi threaded
mode:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">int</span>
<span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">o</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">out</span><span class="p">,</span><span class="n">in</span><span class="p">;</span>
  <span class="n">i</span><span class="p">[</span><span class="s">&quot;in&quot;</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">in</span><span class="p">;</span>

  <span class="c1">//do some cv operation, be sure that the output is a local cv::Mat</span>
  <span class="c1">//so that it doesn&#39;t reuse the memory held in the output</span>
  <span class="c1">//tendril.</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">out</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">));</span>

  <span class="c1">//copy our mat into the output, using the &lt;&lt; operator.</span>
  <span class="c1">//this is a copy by reference, for cv::Mat...</span>
  <span class="n">o</span><span class="p">[</span><span class="s">&quot;out&quot;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">out</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ecto</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Do not use the following method</strong> unless your cell is never going to be run in
a multi threaded app.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">int</span>
<span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">tendrils</span><span class="o">&amp;</span> <span class="n">o</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">in</span><span class="p">;</span>
  <span class="n">i</span><span class="p">[</span><span class="s">&quot;in&quot;</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">in</span><span class="p">;</span>
  <span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">o</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;out&quot;</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">ecto</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The reason for this is that the opencv will work in place on the the memory held
by the output tendril. This will happen without any locking mechanisms, and cells
that use the output downstream may be affected in undefined ways.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="conventions.html" title="ecto_opencv conventions"
             >previous</a> |</li>
    <li><a href="http://ecto.willowgarage.com/">ecto.willowgarage.com</a> &raquo;</li>
    
        <li><a href="index.html">ecto_opencv</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">

    Version <a href="/commit/"></a> at <br/>
        Copyright &copy; 2012,  Willow Garage, Inc.

    <br/>
      
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>